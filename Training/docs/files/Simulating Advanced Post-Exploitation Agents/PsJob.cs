using System;
using System.Windows.Forms;
using System.IO;
using System.Resources;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Net;
using System.Collections.ObjectModel;
using System.Management.Automation;
using System.Management.Automation.Runspaces;

namespace PsJob {
	public class Program {
		static int doIt(string cmd) 
		{
			Runspace runspace = RunspaceFactory.CreateRunspace();
			runspace.Open();
			RunspaceInvoke scriptInvoker = new RunspaceInvoke(runspace);
			Pipeline pipeline = runspace.CreatePipeline();

			pipeline.Commands.AddScript(cmd);
			pipeline.Commands.Add("Out-String");
			Collection<PSObject> results = pipeline.Invoke();			

			StringBuilder stringBuilder = new StringBuilder();
			foreach (PSObject obj in results) {
				stringBuilder.Append(obj);
			}
			string output = stringBuilder.ToString().Trim();
			MessageBox.Show(
				"Simulating Agent running tempjob via Injected PowerShell runspace...\n\n\n" +
				output);
			runspace.Close();
			return 0;
		}
		static void Main(string[] args) 
		{
			doIt(args[0]);
		}
	}
}